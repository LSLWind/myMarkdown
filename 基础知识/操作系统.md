### 基本概念

#### 基础概念

操作系统的主要功能是**资源管理**与**运行程序**，OS直接安装在硬件上，屏蔽硬件细节，向上提供统一抽象接口

资源包括硬件与软件资源，资源管理包括处理器管理（进程/线程）、存储管理（内存）、设备管理（I/O)、文件管理

运行程序：编译链接形成可执行文件→外存→内存分配空间→加上PCB控制块形成进程→执行程序

OS的主要特性为并发性、共享性、异步性（并发执行与顺序执行效果一致）、虚拟性（资源虚化）

内核：OS在硬件上的首层抽象，屏蔽硬件细节，向上提供统一抽象接口

系统调用：内核中函数，获取操作系统服务的唯一途径

系统调用过程：请求系统调用→由用户态转换为核心态→发生中断，现场保护→内核（系统）调用，返回

#### OS结构

##### 单体式结构

整个OS为一个大型可执行二进制文件，在内核中以单一程序方式运行

##### 层次式结构

将OS划分为内核与多个模块，垂直排列，为单向调用关系，低层为高层提供服务

##### 客户机/服务器与微内核结构

划分功能模块与微内核，功能模块为服务器进程，用户进程为客户机进程，使用消息传递进行通信，用户进程向服务器进程请求资源，内核管理服务器进程

#### OS运行模型

##### 非进程模式

将OS组织成一个例行程序，用户程序/数据/堆栈+内核程序/数据/堆栈构成进程映像

##### 进程模式

将OS组织成一组系统进程，OS功能由这些系统进程集合提供

### 处理器管理

指令分特权指令与非特权指令

#### 中断

中断：程序执行过程中发生某个事件时，终止CPU当前程序，转而执行事件的过程

##### 分类

强迫性中断：外部随机事件引起，如电源故障，设备出错等

自愿性中断：程序自己引发的期待事件

外中断：处理器与主存之外的中断

内中断：处理器与主存内部的中断

##### 中断处理

使用硬件+软件实现中断处理，中断寄存器存储中断字，中断字每一位代表一个中断事件，每条指令执行完毕后检查中断字。**中断指令刺激中断源产生中断信号，中断信号置中断字对应位为1，检查中断字发现中断，CPU响应中断请求，中断位置0**

发现中断源，响应中断请求→保护现场，线程→启动中断处理程序→中断返回

##### 中断处理程序

主要用于处理事件与恢复现场，当响应中断时调用中断处理程序，然后保护现场，线程→启动中断处理程序→中断返回。不同的中断源对应不同的中断处理程序，维护一个中断处理程序入口的向量表

#### CPU状态

分用户态与核心态，用户态又称目态，核心态又称管态

用户态只能执行部分指令，当希望调用底层函数时由OS进行调用，进入管态。

**用户态转向管态**：中断是从用户态转向管态的唯一方法，1.当希望执行系统调用时会转向管态2.运行程序发生中断时操作系统接管处理器，执行中断处理程序，转向管态。

**管态转向用户态**：提供一条特权指令，称为加载程序状态字（Load PSW）完成转换。

#### 程序状态字PSW

PSW存储在PSW寄存器内，OS为每个程序设置一个PSW，保存程序运行状态，主要数据包括：

* 程序计数器PC：记录下一条指令要执行的地址
* 条件码：表明指令执行状态
* 中断码：保存程序执行时发生的中断事件
* 中断屏蔽位：出现中断时是否响应中断

### 进程/线程

**进程**：可并发执行的、具有独立功能的程序关于某一个数据集的一次性执行过程，也是操作系统分配资源与保护的基本单位

进程至少包含程序代码与数据集两个部分，即包括一系列顺序指令与该指令集合要操作的数据

要让OS管理进程，则必须还加上进程控制块（PCB），进程=程序代码+相关数据+PCB

#### 进程状态

**三态模型**：

OS管理进程的最基本模型：

* 运行态：占用CPU，执行指令
* 就绪态：具备运行条件，等待OS调度分配CPU以进入运行态
* 阻塞态：进程等待事件发生，目前不能继续执行，缺乏条件
* 